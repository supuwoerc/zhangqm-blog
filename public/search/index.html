<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Search - https://www.supuwoerc.xyz/search/">
    <meta name="author" content="zhangqm - https://www.supuwoerc.xyz">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Search</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://www.supuwoerc.xyz/style.min.20bd185efe9a6c77179f4007cb89793d883bf9ab92c604209b549840b39788ae.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate ">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": true
	}
</div>
    <h1 class="title">
        
            搜索
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

    
    
</div>
</div>
        <div id="content">














<div class="container-main 
     container-search 
    ">

    <div class="desc">
        
    </div>
    
    <div class="toc">
        
        <nav id="TableOfContents"></nav>
    </div>

    <div class='content  content '>
        
    </div>

    <div class="container-search">
    <div id="data" style="display: none;">
        
            
                [{"content":" gin默认自带的结构体字段校验会在校验失败时返回错误信息，但是这些信息对客户端用户并不友好，例如下面的必填校验\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;net/http\u0026#34; ) type user struct { name string `form:\u0026#34;name\u0026#34; binding:\u0026#34;required\u0026#34;` password string `form:\u0026#34;password\u0026#34; binding:\u0026#34;required\u0026#34;` } func loginhandler(c *gin.context) { var user user if err := c.shouldbind(\u0026amp;user); err != nil { c.json(http.statusbadrequest, gin.h{ \u0026#34;message\u0026#34;: err.error(), }) } else { c.json(http.statusok, gin.h{ \u0026#34;message\u0026#34;: \u0026#34;成功\u0026#34;, }) } } func main() { fmt.println(\u0026#34;美化gin的validator验证器\u0026#34;) //_ = validatorinit(\u0026#34;zh\u0026#34;) g := gin.default() g.post(\u0026#34;/login\u0026#34;, loginhandler) _ = g.run(\u0026#34;:3600\u0026#34;) } 当字段校验失败时，请求体内容为error.error()\n{ \u0026#34;message\u0026#34;: \u0026#34;key: \u0026#39;user.name\u0026#39; error:field validation for \u0026#39;name\u0026#39; failed on the \u0026#39;required\u0026#39; tag\\nkey: \u0026#39;user.password\u0026#39; error:field validation for \u0026#39;password\u0026#39; failed on the \u0026#39;required\u0026#39; tag\u0026#34; } 这种校验信息对客户端用户来说是无意义的，所以需要将这个信息翻译成适应客户端用户的语种，validator提供能语种翻译的能力，只需要按照场景来设置默认翻译语种即可，下面的代码中init方法是根据传入的地区去注册翻译器，translate是将验证产生的错误使用翻译器将错误放入结果切片中（错误可能不止一个）\npackage main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/gin-gonic/gin/binding\u0026#34; \u0026#34;github.com/go-playground/locales/en\u0026#34; \u0026#34;github.com/go-playground/locales/zh\u0026#34; ut \u0026#34;github.com/go-playground/universal-translator\u0026#34; \u0026#34;github.com/go-playground/validator/v10\u0026#34; en_translations \u0026#34;github.com/go-playground/validator/v10/translations/en\u0026#34; zh_translations \u0026#34;github.com/go-playground/validator/v10/translations/zh\u0026#34; ) var ( trans ut.translator ) func validatorinit(locale string) error { if validate, ok := binding.validator.engine().(*validator.validate); ok { //国际化语言 zht := zh.new() ent := en.new() uni := ut.new(ent, zht) var found bool trans, found = uni.gettranslator(locale) if !found { fmt.println(\u0026#34;未找到对应语种\u0026#34;) } //注册翻译 switch locale { case \u0026#34;zh\u0026#34;: _ = zh_translations.registerdefaulttranslations(validate, trans) case \u0026#34;en\u0026#34;: _ = en_translations.registerdefaulttranslations(validate, trans) default: _ = zh_translations.registerdefaulttranslations(validate, trans) } return nil } else { return errors.new(\u0026#34;类型断言失败\u0026#34;) } } func translate(err error) gin.h { var result = gin.h{} validationerrors := err.(validator.validationerrors) for _, v := range validationerrors { result[v.field()] = v.translate(trans) } return result } 在main方法中调用init方法，为validator注册对应的翻译器\nfunc main() { fmt.println(\u0026#34;美化gin的validator验证器\u0026#34;) _ = validatorinit(\u0026#34;zh\u0026#34;) g := gin.default() g.post(\u0026#34;/login\u0026#34;, loginhandler) _ = g.run(\u0026#34;:3600\u0026#34;) } 在校验失败时翻译对应的错误到响应之中\nfunc loginhandler(c *gin.context) { var user user if err := c.shouldbind(\u0026amp;user); err != nil { c.json(http.statusbadrequest, gin.h{ \u0026#34;message\u0026#34;: translate(err), }) } else { c.json(http.statusok, gin.h{ \u0026#34;message\u0026#34;: \u0026#34;成功\u0026#34;, }) } } 响应中的错误信息已经被自动翻译\n{ \u0026#34;message\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;name为必填字段\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;password为必填字段\u0026#34; } } 代码：https://github.com/supuwoerc/go-tips/tree/main/validators\n","date":"2023-03-11","permalink":"https://www.supuwoerc.xyz/posts/tech/ginvalidator%E9%AA%8C%E8%AF%81%E7%BE%8E%E5%8C%96/","summary":"Gin默认自带的结构体字段校验会在校验失败时返回错误信息，但是这些信息对客户端用户并不友好，例如下面的必填校验 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;net/http\u0026#34; ) type User struct { Name string `form:\u0026#34;name\u0026#34; binding:\u0026#34;required\u0026#34;` Password string `form:\u0026#34;password\u0026#34; binding:\u0026#34;required\u0026#34;` } func LoginHandler(c *gin.Context) {","title":"【gin】validator验证美化"},{"content":"容器转为镜像 #将容器转为镜像 docker commit 容器id 镜像名称:版本号 #将镜像压缩为文件 dokcer save -o 压缩文件名称 镜像名称:版本号 #将镜像压缩文件还原成镜像 docker load -i 文件 容器挂载到数据卷是不会被带入到镜像中的，但是在容器内部的文件是可以被带入还原为镜像的\n","date":"2023-03-07","permalink":"https://www.supuwoerc.xyz/posts/tech/docker%E5%AE%B9%E5%99%A8%E8%BD%AC%E4%B8%BA%E9%95%9C%E5%83%8F/","summary":"容器转为镜像 #将容器转为镜像 docker commit 容器id 镜像名称:版本号 #将镜像压缩为文件 dokcer save -o 压缩文件名称 镜像名称:版本号 #将镜像压缩文件还原成镜像 docker load -i 文件 容器挂载到数据卷","title":"【docker】容器转为镜像"},{"content":"数据卷 数据卷是宿主机和容器存在映射关系的文件或者目录 宿主机对数据卷修改会立即同步到容器，反之依然，即映射关系 数据卷和容器是多对多的关系，一个数据卷可以被多个容器挂载，一个容器也可以挂载多个数据卷 配置 #-v:配置数据卷 docker run ... -v 宿主机目录/文件:容器目录/文件 目录/文件必须为绝对路径 目录不存在时将被创建 可以挂载多个数据卷 数据卷容器 一个专门的容器，用来作为数据卷，将多个容器和宿主机文件做映射 # -v：挂载数据卷容器datas,docker将自动在宿主机上创建对应的数据映射目录/文件 docker run -it --name=datas -v /volume centos:7 /bin/bash # 创建容器test1,和数据卷容器设置数据卷映射关系 docker run -it --name=test1 --volume-form datas centos:7 /bin/bash # 创建容器test2,和数据卷容器设置数据卷映射关系 docker run -it --name=test2 --volume-form datas centos:7 /bin/bash ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/docker%E5%85%A5%E9%97%A8%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7/","summary":"数据卷 数据卷是宿主机和容器存在映射关系的文件或者目录 宿主机对数据卷修改会立即同步到容器，反之依然，即映射关系 数据卷和容器是多对多的关系，一个数据卷可以被多个容器","title":"【docker】入门容器数据卷"},{"content":"创建\u0026amp;关闭容器 #-i:交互式操作，使得容器保持运行 -t:分配给容器一个终端来运行 --name容器名字 /bin/bash可以不加,加上会进入容器shell docker run -i -t --name=test redis:5.0 /bin/bash # 进入容器之后执行exit退出容器，如果是-t创建的容器，exit会关闭容器 exit #-d:守护式容器，后台运行容器，exit执行不会关闭容器 docker run -i -d --name=test redis:5.0 查看\u0026amp;进入容器 #查看当前运行的容器 docker ps #查看全部容器，包含未运行中的容器 docker ps -a # 进入后台运行的容器test docker exec -it test /bin/bash 运行\u0026amp;停止\u0026amp;删除\u0026amp;查看容器 #停止容器test docker stop test #启动容器test docker start test #删除容器test docker rm test #查看容器test的信息 docker inspect test ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/docker%E5%85%A5%E9%97%A8%E5%AE%B9%E5%99%A8/","summary":"创建\u0026amp;关闭容器 #-i:交互式操作，使得容器保持运行 -t:分配给容器一个终端来运行 --name容器名字 /bin/bash可以不加,加上会进入容器shell","title":"【docker】入门容器"},{"content":"安装 yum install -y yum-utils device-mapper-persistent-data lvm2 # 安装docker依赖的包 yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo#设置docker源 yum list docker-ce --showduplicates | sort -r # 查看全部docker版本 yum -y install docker-ce-18.03.1.ce # 安装某一个版本 服务 systemctl start docker # 启动docker systemctl enable docker # 设置开机启动docker systemctl status docker #查看docker状态 systemctl stop docker # 关闭docker systemctl restart docker # 重启docker 镜像 docker images # 查看安装的全部镜像 docker search redis # 搜索全部redis相关镜像 docker pull redis # 下载redis 默认latest 可以指定版本，如：docker pull reids:5.0 docker rmi f9c173b0f012 # 卸载id为f9c173b0f012的镜像 remove image ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/docker%E5%85%A5%E9%97%A8%E5%AE%89%E8%A3%85%E5%92%8C%E9%95%9C%E5%83%8F/","summary":"安装 yum install -y yum-utils device-mapper-persistent-data lvm2 # 安装docker依赖的包 yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-c","title":"【docker】入门安装和镜像"},{"content":"javascript中的gc(garbage collection)算法机制 引用计数 function func(){ const user1={} const user2={} user1.friend = user2 // user2引用数+1 user2.friend = user1 // user1引用数+1,并且user1和user2为互相引用关系 } func() 原理：当gc发现某一块内存中对象中的引用数为0时，gc会回收该块内存，实现垃圾回收。 缺陷：上述代码中存在循环引用的情况，那么在方法调用后user1和user2的引用数永远不会为0，gc机制不能将这两个变量回收掉。（一般出现在ie\u0026lt;8，firefox3的浏览器中，ie6和ie7中有一部分对象是c++实现的com（component object model），该种对象依赖于引用计数的策略来回收）\n标记清除（目前主流的浏览器均实现了该方式的gc） 原理：gc从window对象开始逐级对对象进行遍历，将可到达的节点对象结果和全部对象数据做对比，如果存在不被引用的对象空间，那么该空间会被回收。 优点：解决了循环引用算法不能合理gc的问题，即使两个对象互相引用，只要这两个对象不被外部访问（可到达的节点），那么互相引用的对象会被一起回收。\njavascript常见的内存泄漏原因 非严格模式下的在window上缓存了变量 function func(){ bar = something //非严格模式下这样的语句会在window上挂载该变量 or this.bar = something //在上下文为window时该语句等同于上面 } func() 控制台上的输出 function func(){ //tips：一般来说可以借助webpack等构建工具来自动清除相类似的输出语句 console.log(something) //当用户打开控制台时候，这个变量会占用内存（不打开控制台不会出现内存占用） } 闭包 function func(){ const a = 0 const b = 1 function test(){ a++ \u0026amp;\u0026amp; b++ return a + b } return test } // testfn能访问它的上下文中的全部数据（func的作用域），占用内存会比较大 const testfn = func() //此处的声明将会的到func执行后返回的test函数，该函数一直会被引用，内存空间将不会释放 testfn() //调用函数 testfn = null //通过手动释放内存来避免引起的内存问题 定时器未及时清除 function func(){ const timer = setinterval(()=\u0026gt;{ //do something },1000) clearinterval(timer) //清除定时器 } func() listener中的匿名函数和错误的解绑 // 为按钮绑定点击事件 function bindevent(){ const btn = document.getelementbyid(\u0026#34;id\u0026#34;) // 绑定的是匿名函数 ！ btn.addeventlistener(\u0026#39;click\u0026#39;, function (event) { // do something }, false); } bindevent() // 每次调用一次方法btn都会绑定上一个新的函数，因为匿名函数在内存中占用的内存不一样 //vue中借助lodash的防抖 mounted() { window.addeventlistener(\u0026#39;scroll\u0026#39;, debounce(this.func, 200)) } beforedestroy() { window.removeeventlistener(\u0026#39;scroll\u0026#39;, debounce(this.func, 200)) } 同一个元素节点注册了多个相同的eventlistener，那么重复的实例会被抛弃。这么做不会让得eventlistener被重复调用，也不需要用removeeventlistener手动清除多余的eventlistener，因为重复的都被自动抛弃了。而这条规则只是针对于命名函数。对于匿名函数，浏览器会将其看做不同的eventlistener，所以只要将匿名的eventlistener，命名一下就可以解决问题\nconst callback = function (event) { // do something } // 为按钮绑定点击事件 function bindevent(){ const btn = document.getelementbyid(\u0026#34;id\u0026#34;) // 绑定的是匿名函数 ！ btn.addeventlistener(\u0026#39;click\u0026#39;, callback, false); } bindevent() // 此时callback始终是一个函数对象 使用开发者工具分析 下面使用vue3搭建的简单示例来模拟内存泄漏的场景，现在常见的业务系统都是依赖于框架和库来搭建，这样的例子更能贴切点实际场景，来总结如何分析应用内存泄漏\n\u0026lt;a-button type=\u0026#34;primary\u0026#34; @click=\u0026#34;mockmomery\u0026#34;\u0026gt; 模拟内存溢出 \u0026lt;/a-button\u0026gt; \u0026lt;a-button type=\u0026#34;primary\u0026#34; @click=\u0026#34;mockdetacheddom\u0026#34;\u0026gt; 脱离文档流的dom \u0026lt;/a-button\u0026gt; const mockmomery = () =\u0026gt; { console.log(\u0026#34;模拟内存溢出\u0026#34;); const patch = new array\u0026lt;string\u0026gt;(200).fill(\u0026#34;一些测试文字\u0026#34;) if (!(window as any).mockmomerystrs) { (window as any).mockmomerystrs = [\u0026#34;一些测试文字\u0026#34;] } else { (window as any).mockmomerystrs.push(...patch) } console.log((window as any).mockmomerystrs); } const mockdetacheddom = () =\u0026gt; { console.log(\u0026#34;模拟脱离文档流的内存溢出\u0026#34;); if (!(window as any).detachednodes) { (window as any).detachednodes = [document.createelement(\u0026#34;div\u0026#34;)] } else { (window as any).detachednodes.push(document.createelement(\u0026#34;div\u0026#34;)) } } 确定可以操作是否真的会是内存泄漏 打开控制台调试工具，找到perfermance面板，刷新网页后点击录制按钮，重复多次的执行可能导致页面崩溃的操作后点击结束录制，可以看到录制时间内浏览器关于js heap size的变化，如果出现了类似下图的曲线（内存占用线的最低部一直不断的升高），那么录制过程中的操作很有可能就是导致内存泄漏的部分\n借助内存快照分析两次操作直接发生了什么 上面一步的操作基本可以确定那些页面上的操作可能会导致内存泄漏，下面就利用控制台上的memory面板来具体的分析每次操作之间到底发是什么发生了内存变化。\ntips：这里记录一下gmai团队分享出来的内存分析技巧（three snapshot技巧）\n在记录第一个堆快照之前你可以先做一些“预热”操作，避免一些懒加载和缓存策略影响到了对内存的分析 预热完成，记录当前页面的一次内存快照 操作一次可能导致内存泄漏的操作，再次记录一次内存快照 多次执行可能导致内存泄漏的操作，最后再记录一次内存快照 选择对比方式来比较每次快照之间的内存变化 对比两次内存快照，按照retained size（对象回收可释放内存大小）或者shallow size（对象自身占用内存，即不包含对象内的引用的内存大小）排序，发现一些比较大的内存变化\n根据对象的引用树定位问题代码 游离于dom树之外的游离detached dom导致的内存溢出 除了javascript对象导致的内存溢出，detached dom也会是导致引用内存溢出的原因之一\ndetached dom即未出现在document文档流上的元素，但是该元素被引用，导致不能被回收内存\n同样的分析方式，在class filter中添加过滤条件，筛选出游离于文档流的元素\n参考文章：游离dom导致地内存泄漏\n示例站点：detached dom\n参考 排查javascript内存泄漏 内存常见的 javascript 内存泄露分析 javascript内存那点事 ie\u0026lt;8循环引用导致的内存泄漏 内存泄漏之jquery.cache 内存泄漏之listeners ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%86%85%E5%AD%98%E5%B0%8F%E7%BB%93/","summary":"JavaScript中的GC(Garbage collection)算法机制 引用计数 function func(){ const user1={} const user2={} user1.friend = user2 // user2引用数+1 user2.friend = user1 // user1引用数+1,并且us","title":"浏览器内存小结"},{"content":"nrm：管理npm资源仓库的包 安装 npm install -g nrm #全局安装 nrm ls #查看当前可用的源 nrm current #查看当前使用的源 添加源 nrm add \u0026lt;registry\u0026gt; \u0026lt;url\u0026gt; #添加源 切换源 nrm use taobao #切换到taobao源 测试源速度 nrm test \u0026lt;registry\u0026gt; #测试源 删除源 nrm del \u0026lt;registry\u0026gt;#删除源 nvm：管理 node版本的包 安装 brew install nvm #我是使用macos的brew安装的 win需要去官网下载安装 安装不同的node版本 nvm install \u0026lt;version\u0026gt; #安装特定版本号的node 卸载某一个版本的node nvm uninstall \u0026lt;version\u0026gt; #卸载具体版本的node 切换版本 nvm use \u0026lt;version\u0026gt; #切换某一个版本 查看已经安装的版本 nvm ls #查看本地安装的版本列表 查看远程仓库的所有可安装版本 nvm ls-remote #查看可安装的全部版本 pnpm：高性能的包管理工具 安装 npm install -g pnpm #全局安装pnpm 配置本地的仓库位置 pnpm config set registry http://registry.npm.taobao.org #设置pnpm仓库的源 关于安装依赖的一些命令 pnpm install xxx #安装包 pnpm add -d xxx #写入开发依赖里面 pnpm add -g xxx #全局安装 更新和卸载包 pnpm up xxx #更新包 pnpm remove xxx #卸载包 ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/%E5%89%8D%E7%AB%AF%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%B0%8F%E7%BB%93/","summary":"nrm：管理npm资源仓库的包 安装 npm install -g nrm #全局安装 nrm ls #查看当前可用的源 nrm current #查看当前使用的源 添加源 nrm add \u0026lt;registry\u0026gt; \u0026lt;url\u0026gt; #添加源 切换源 nrm use taobao #切换到taobao源 测试源速","title":"前端包管理工具小结"},{"content":"混淆在业务代码中 直接在业务方法上添加日志上报的方法\n与业务代码耦合在一起，难以维护 @component({ name: \u0026#34;demo\u0026#34;, }) export default class demo extends vue { btnclick(){ /** * 一些业务代码实现 */ /** * 日志上报代码的实现 */ } } vue基于指令的埋点实现 vue3中借助自定义指令实现点击事件埋点指令\n区别于vue2注册指令的方式，vue3不在将指令挂载到vue.prototype import { app, directive } from \u0026#34;vue\u0026#34;; import { logger } from \u0026#34;./modules/logger\u0026#34;; /** * 注册全局指令 * @param app */ const directives: record\u0026lt;string, directive\u0026gt; = { logger, }; export const directiveregister = (app: app) =\u0026gt; { object.keys(directives).foreach((item) =\u0026gt; { app.directive(item, directives[item]); }); }; 自定义指令实现细节\n在指令绑定到元素attribute前为指令元素注入点击回调和指令参数 当传入指令的参数发生变化时需要更新元素的的参数 指令绑定元素在dom树上卸载前需要移除事件监听 import { clicklogaction } from \u0026#34;@/utils/logger\u0026#34;; import { directive, directivebinding } from \u0026#34;vue\u0026#34;; interface loggerelement extends htmlelement { loggerparams: any; loggercallback: () =\u0026gt; void; } export const logger: directive = { created(el: loggerelement, binding: directivebinding) { el.loggerparams = binding.value; el.loggercallback = function () { clicklogaction(el.loggerparams); //自定义日志上报的方法 }; }, updated(el: loggerelement, binding: directivebinding) { el.loggerparams = binding.value; }, mounted(el: loggerelement) { el.addeventlistener(\u0026#34;click\u0026#34;, el.loggercallback); }, beforeunmount(el: loggerelement) { el.removeeventlistener(\u0026#34;click\u0026#34;, el.loggercallback); }, }; 借助ts装饰器的埋点实现 借助typescript中的装饰器对方法进行修饰\nvue3中的setup方法和语法糖均不支持该ts预案：github issue 下面的代码是同步埋点的方案，如果需要依赖于异步数据的话，需要自己实现promise链式的将异步数据传递下去 本质上是实现了编程中面向切面编程的思想(aop) 可以阅读下这篇文章：javascript中的aop /** * 点击埋点装饰器工厂 * @param 埋点参数 * @returns */ export function clicklog(params: clicklogparams) { return function (target: any, key: string, descriptor: propertydescriptor) { const fn = descriptor.value descriptor.value = async function (...args: any) { /** * 实现埋点方法上报数据 */ return fn.call(this, ...args) } return descriptor } } ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/%E5%89%8D%E7%AB%AF%E5%9F%8B%E7%82%B9%E6%96%B9%E6%A1%88%E5%B0%8F%E7%BB%93/","summary":"混淆在业务代码中 直接在业务方法上添加日志上报的方法 与业务代码耦合在一起，难以维护 @Component({ name: \u0026#34;Demo\u0026#34;, }) export default class Demo extends Vue { btnClick(){ /** * 一些业务代码实现 */ /** * 日志上报代码的实现 */ } } Vue","title":"前端埋点方案小结"},{"content":"http-cache优先级 先判断是否命中强缓存，命中将从disk取相关资源 判断是否命中协商缓存，命中将发起一个请求，服务端根据request header里的if-none-match（对应etag）和if-modified-since（对应last-modified）判断资源是否过期，没过期则返回304状态码，浏览器依旧用disk里的资源。如果资源过期，则服务端会返回新的资源 没命中协商缓存则发起真实的请求，从服务器获取资源 浏览器访问资源的情况 从强缓存开始判断 地址栏输入url回车 页面中的link跳转/打开新窗口/新标签页/history的前进后退 initiator值为other的内容，跳过强缓存，从协商缓存开始判断的情况（浏览器会在请求头自动带上cache-control:max-age=0） 点击刷新按钮 f5/ctrl+r刷新按钮 发起真实的请求到服务器（浏览器会在请求头自动带上cache-control:no-cache\u0026amp;pragma:no-cache） 硬性重新加载（disk上的缓存不会删除） ctrl+f5（disk上的缓存不会删除） ctrl+shift+r（disk上的缓存不会删除） 勾选了disable-cache后的刷新（disk上的缓存不会删除） 清空缓存后硬性加载（disk上的缓存会删除） cache-control在请求头和在响应头的区别 在请求头中的cache-control影响的是当前这一次请求，响应头是告诉浏览器如何处理响应数据，影响的是未来的请求。\nrequest-header中cache-control的含义 cache-control:max-age=0：发出真实的请求到服务器，会判断是否满足协商缓存的条件，满足的话加载协商缓存 cache-control:no-cache：此次请求不会读取缓存资源，即使缓存未过期 spa单页应用的设置 入口文件index.html设置为协商缓存，每次都向服务器发起请求，确定资源是否过期。 css，js设置为强缓存，因为在打包时会产生一个hash文件名，并且全部的静态资源都由html引入，所以只要获取到最新的index.html，这些静态资源都会被自动的引入 location / { if ($uri = \u0026#39;/index.html\u0026#39;){ add_header cache-control \u0026#39;no-store\u0026#39;; } } 参考 mdn上关于cache-control的文档 解决单页应用html被缓存的nginx配置 ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/%E7%BC%93%E5%AD%98%E5%B0%8F%E7%BB%93/","summary":"http-cache优先级 先判断是否命中强缓存，命中将从disk取相关资源 判断是否命中协商缓存，命中将发起一个请求，服务端根据Request Header里的If","title":"缓存小结"},{"content":"服务器安装jdk jenkins最新版本要求jdk版本要11或者17的版本，我自己最开始服务器上部署过jdk1.8所以得先卸载掉\n查询和卸载已经安装过的jdk rpm -qa | grep java #查看已经安装到jdk信息 rpm -e --nodeps java-* #卸载上一步查询到的jdk相关信息\u0026lt;和openjdk相关的jdk全部卸载\u0026gt; 安装jdk17到服务器 cd /usr/local # 找一个目录安装jdk wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz tar -zxvf jdk-17_linux-x64_bin.tar.gz 配置环境变量 vim /etc/profile #进入profile文件,在文件的最后面添加java老三样的配置 # 在文件最下方添加 export java_home=/usr/local/java-17.0.6 #配置下java_home就行,下面的两个变量依赖于它 export path=$path:$java_home/bin; export classpath=.:$java_home/lib/dt.jar:$java_home/lib/tools.jar; source /etc/profile #刷新环境变量 java -version #检查安装结果 能输出java的版本信息就算安装成功了 jdk准备好之后就可以安装jenkins了 yum install -y jenkins #yum安装jenkins systemctl start jenkins #启动服务 #jenkins在启动之后会在输出信息里面将初始密码打印出来,但是我没注意到,没关系，可以在对应文件里面找到 #jenkins初始密码在这个位置/jenkins_home/secrets/initialadminpassword jenkins之后在面板上选择默认的全家桶安装就行了\u0026lt;当然你也可以自己挑选需要的插件和工具\u0026gt; 开始配置git #先看自己的服务器有没有生成过ssh-key,没有的话需要先生成 ssh-keygen -t rsa -c \u0026#34;test@gmail.com\u0026#34; #生成ssh-key 将生成的公钥配置到github/gitlab/gitee上 将生成的私钥部署到jenkins的credentials里面 配置项目的git地址和构建要执行的脚本，这里我就很简单的配置了一下 #!/bin/sh -l echo \u0026#34;开始构建任务-进入/use/blog\u0026#34; cd /usr/blog echo \u0026#34;删除文件夹中全部文件\u0026#34; rm -rf * echo \u0026#34;开始克隆远程仓库内容到本地\u0026#34; git clone git@github.com:supuwoerc/zhangqm-blog.git echo \u0026#34;进入本地源码文件夹\u0026#34; cd zhangqm-blog echo \u0026#34;删除旧的版本\u0026#34; cd public rm -rf * cd ../ echo \u0026#34;执行hugo打包静态资源\u0026#34; hugo --theme=paper --baseurl=\u0026#34;https://www.supuwoerc.xyz\u0026#34; echo \u0026#34;移动产物目录到nginx指向\u0026#34; cp -rf /usr/blog/zhangqm-blog/public /home echo \u0026#34;构建成功\u0026#34; 构建发布 ","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/tech/%E4%BD%BF%E7%94%A8jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2/","summary":"服务器安装jdk jenkins最新版本要求jdk版本要11或者17的版本，我自己最开始服务器上部署过jdk1.8所以得先卸载掉 查询和卸载已经安装过的jdk rpm -qa |","title":"使用jenkins自动部署hugo博客"},{"content":"年末岁初 2023年末，放假的第一天，打开音乐戴上耳机，随机到的是李志的《墙上的向日葵》，正如歌词里面唱的一样：“时光就这样悄悄的溜走”，忽然意识一年已经过去了，我始终是一个比较悲观的人，每次想到未来，我大概率是不太有乐观的，但即使这样，似乎在生活中我一直在给别人正反馈和一些不能作用于自己的比较正面的劝诫，想起这一年也是发生了许多，赶在农历新年之前记录一下。\n今年发生的事情很多，裸辞，新工作，新冠，亲人的离开，以及明年要迎接的新生命，其实我自己内心似乎还没能接受自己身份上的转变，这一些事情积累起来似乎应该很久，但恰恰相反，它们发生的太快了。不知道是不是这些就算是人生的阅历，感觉自己的心理年龄突然就被这些经历的事情快速提高，或许是无病呻吟，或许是多愁善感，年末的时间自己经常回想之前的一些经历，给自己一些从这些经历上学到的教训，在未来的日子里能提醒自己不再毫无防备的犯错。\n角色 这几年自己养起了记录待办的习惯，年末自己的待办上多出了年底要讨论的房贷，明年孩子出生前的一些准备事项，过年要准备的一些琐碎。这些之前我一直依赖父母的帮助，现在也是他们帮我来置办一些零碎，但是脑子里意识到慢慢的我要接替我新的角色，新的身份了，国庆回家置办房子的一些事情，心底意识到父母已经老了，他们在慢慢的与社会脱节，他们习惯于用他们的习惯去处理所有的事情，而常常不符合社会的新规则。一代人慢慢老去，一代人慢慢离开，而我这一代正慢慢变为曾经的“大人们”，“家长们”，虽然这些事情是自然规律，合情合理，但是给我的感觉就是发生的很突然，感慨良多。\n熵增 和前面提到的一样，不管愿望如何，我对未来的看法是不乐观的，我讨厌生活中各种零碎的事情搅扰我的生活，但是目前来看，熵增原理似乎也适用于生活，生活里的琐碎只会越来越多，越来越乱。\n“像恐惧的鱼，拼命的游，时光就这样悄悄的溜走”\n希望明年能平静些。\n","date":"2023-03-04","permalink":"https://www.supuwoerc.xyz/posts/life/%E8%BE%9E%E6%97%A7%E5%B2%81/","summary":"年末岁初 2023年末，放假的第一天，打开音乐戴上耳机，随机到的是李志的《墙上的向日葵》，正如歌词里面唱的一样：“时光就这样悄悄的溜走”，忽然意识一年已经过去了，","title":"辞旧岁"},]
            
        
    </div>

    <div id="search">
        
        <span class="sc-icon"><img src="/imgs/icons/search.svg" width="48"> </span>
        <span id="sc-clear" onclick="clearInputVal()">✖</span>
        <input id="sc-input" oninput="search()" type="text" placeholder="here search search..." />
        <div id="sc-res"></div>
    </div>
    <script src="/js/search.js" defer></script>
</div>

    


    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        皖ICP备20001764号-1
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
